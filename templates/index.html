<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Breach Hog Search</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/basecoat-css@0.3.11/dist/basecoat.cdn.min.css"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/basecoat-css@0.3.11/dist/js/all.min.js"
      defer
    ></script>
    <script src="https://cdn.jsdelivr.net/npm/htmx.org@2.0.8/dist/htmx.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>

    <script>
      (() => {
        try {
          const stored = localStorage.getItem("themeMode");
          if (
            stored
              ? stored === "dark"
              : matchMedia("(prefers-color-scheme: dark)").matches
          ) {
            document.documentElement.classList.add("dark");
          }
        } catch (_) {}

        const apply = (dark) => {
          document.documentElement.classList.toggle("dark", dark);
          try {
            localStorage.setItem("themeMode", dark ? "dark" : "light");
          } catch (_) {}
        };

        document.addEventListener("basecoat:theme", (event) => {
          const mode = event.detail?.mode;
          apply(
            mode === "dark"
              ? true
              : mode === "light"
                ? false
                : !document.documentElement.classList.contains("dark"),
          );
        });
      })();
    </script>
  </head>

  <body class="min-h-screen flex flex-col">
    <!-- Dark mode toggle -->
    <nav class="w-full p-4 flex justify-end">
      <button
        type="button"
        aria-label="Toggle dark mode"
        onclick="document.dispatchEvent(new CustomEvent('basecoat:theme'))"
        class="btn-icon-outline size-8"
      >
        <span class="hidden dark:block">
          <!-- Sun icon -->
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <circle cx="12" cy="12" r="4" />
            <path d="M12 2v2" />
            <path d="M12 20v2" />
            <path d="m4.93 4.93 1.41 1.41" />
            <path d="m17.66 17.66 1.41 1.41" />
            <path d="M2 12h2" />
            <path d="M20 12h2" />
            <path d="m6.34 17.66-1.41 1.41" />
            <path d="m19.07 4.93-1.41 1.41" />
          </svg>
        </span>
        <span class="block dark:hidden">
          <!-- Moon icon -->
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z" />
          </svg>
        </span>
      </button>
    </nav>

    <!-- Search bar -->
    <div class="flex-1 flex items-center justify-center max-w-">
      <div class="w-full max-w-sm flex flex-col items-center gap-4">
        <form
          class="flex w-full"
          hx-post="/content/search"
          hx-target="#results"
          hx-swap="innerHTML"
          hx-indicator="#spinner"
        >
          <input
            name="query"
            type="search"
            placeholder="Search by entity:value"
            class="input flex-1 mr-2"
          />
          <button class="btn-outline">Search</button>
        </form>

        <!-- Loading spinner -->
        <div id="spinner" class="htmx-indicator">
          <article
            class="group/item flex items-center border text-sm rounded-md transition-colors flex-wrap outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] border-transparent bg-muted/50 p-4 gap-4"
          >
            <div
              class="flex shrink-0 items-center justify-center [&_svg]:pointer-events-none [&_svg]:size-4"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                role="status"
                aria-label="Loading"
                class="animate-spin"
              >
                <path d="M21 12a9 9 0 1 1-6.219-8.56" />
              </svg>
            </div>
            <div class="flex flex-1 flex-col gap-1">
              <h3
                class="flex w-fit items-center gap-2 text-sm leading-snug font-medium line-clamp-1"
              >
                Searching...
              </h3>
            </div>
          </article>
        </div>
      </div>
    </div>

    <!-- Results container -->
    <div id="results" class="flex flex-col w-full space-y-4">
      <!-- HTMX will inject breach count + results here -->
    </div>
  </body>
</html>
